local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local VirtualInputManager = game:GetService("VirtualInputManager")
local player = Players.LocalPlayer

local isMobile = UserInputService.TouchEnabled and not UserInputService.MouseEnabled

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AntiAFKGui"
ScreenGui.Parent = player:WaitForChild("PlayerGui")

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = isMobile and UDim2.new(0, 140, 0, 110) or UDim2.new(0, 250, 0, 180)
MainFrame.Position = UDim2.new(0.5, isMobile and -70 or -125, 0.5, isMobile and -55 or -90)
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

local UIStroke = Instance.new("UIStroke")
UIStroke.Thickness = 2
UIStroke.Color = Color3.fromRGB(30, 30, 30)
UIStroke.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, isMobile and -45 or -60, 0, isMobile and 18 or 25)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Title.BorderSizePixel = 0
Title.Text = "Anti-AFK"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = isMobile and 11 or 14
Title.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 8)
TitleCorner.Parent = Title

local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = isMobile and UDim2.new(0, 22, 0, 18) or UDim2.new(0, 30, 0, 25)
CloseButton.Position = UDim2.new(1, isMobile and -22 or -30, 0, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(220, 70, 70)
CloseButton.BorderSizePixel = 0
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = isMobile and 11 or 14
CloseButton.Parent = MainFrame

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = isMobile and UDim2.new(0, 22, 0, 18) or UDim2.new(0, 30, 0, 25)
MinimizeButton.Position = UDim2.new(1, isMobile and -44 or -60, 0, 0)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(90, 90, 90)
MinimizeButton.BorderSizePixel = 0
MinimizeButton.Text = "_"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.TextSize = isMobile and 11 or 14
MinimizeButton.Parent = MainFrame

local MinimizeCorner = Instance.new("UICorner")
MinimizeCorner.CornerRadius = UDim.new(0, 6)
MinimizeCorner.Parent = MinimizeButton

local ToggleButton = Instance.new("TextButton")
ToggleButton.Name = "ToggleButton"
ToggleButton.Size = isMobile and UDim2.new(0, 65, 0, 28) or UDim2.new(0, 100, 0, 40)
ToggleButton.Position = UDim2.new(0.5, isMobile and -32.5 or -50, 0.5, isMobile and -14 or -20)
ToggleButton.AnchorPoint = Vector2.new(0.5, 0.5)
ToggleButton.BackgroundColor3 = Color3.fromRGB(220, 70, 70)
ToggleButton.BorderSizePixel = 0
ToggleButton.Text = "Off"
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.TextSize = isMobile and 11 or 14
ToggleButton.Parent = MainFrame

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(0, 8)
ToggleCorner.Parent = ToggleButton

local afkEnabled = false
local minimized = false
local afkConnections = {}

local function enableAntiAFK()
    for _, connection in ipairs(afkConnections) do
        connection:Disconnect()
    end
    afkConnections = {}
    
    local clickConnection = RunService.Heartbeat:Connect(function()
        local virtualUser = game:GetService("VirtualUser")
        virtualUser:CaptureController()
        virtualUser:ClickButton2(Vector2.new())
    end)
    table.insert(afkConnections, clickConnection)
    
    local mouseMoveConnection = RunService.Heartbeat:Connect(function()
        if not afkEnabled then return end
        
        local currentTime = tick()
        if currentTime % 5 < 0.1 then
            local mousePos = Vector2.new(100, 100)
            VirtualInputManager:SendMouseMoveEvent(mousePos, game:GetService("CoreGui"))
            task.wait(0.05)
            VirtualInputManager:SendMouseMoveEvent(mousePos + Vector2.new(1, 0), game:GetService("CoreGui"))
            task.wait(0.05)
            VirtualInputManager:SendMouseMoveEvent(mousePos, game:GetService("CoreGui"))
        end
    end)
    table.insert(afkConnections, mouseMoveConnection)
    
    local keyPressConnection = RunService.Heartbeat:Connect(function()
        if not afkEnabled then return end
        
        local currentTime = tick()
        if currentTime % 10 < 0.1 then
            local keys = {Enum.KeyCode.W, Enum.KeyCode.A, Enum.KeyCode.S, Enum.KeyCode.D}
            local randomKey = keys[math.random(1, #keys)]
            
            VirtualInputManager:SendKeyEvent(true, randomKey, false, game)
            task.wait(0.05)
            VirtualInputManager:SendKeyEvent(false, randomKey, false, game)
        end
    end)
    table.insert(afkConnections, keyPressConnection)
end

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

MinimizeButton.MouseButton1Click:Connect(function()
    if minimized then
        MainFrame.Size = isMobile and UDim2.new(0, 140, 0, 110) or UDim2.new(0, 250, 0, 180)
        ToggleButton.Visible = true
        MinimizeButton.Text = "_"
        minimized = false
    else
        MainFrame.Size = UDim2.new(0, 140, 0, isMobile and 18 or 25)
        ToggleButton.Visible = false
        MinimizeButton.Text = "+"
        minimized = true
    end
end)

ToggleButton.MouseButton1Click:Connect(function()
    afkEnabled = not afkEnabled
    
    if afkEnabled then
        ToggleButton.BackgroundColor3 = Color3.fromRGB(70, 220, 70)
        ToggleButton.Text = "On"
        enableAntiAFK()
    else
        ToggleButton.BackgroundColor3 = Color3.fromRGB(220, 70, 70)
        ToggleButton.Text = "Off"
        for _, connection in ipairs(afkConnections) do
            connection:Disconnect()
        end
        afkConnections = {}
    end
end)

if isMobile then
    MainFrame.Draggable = true
end

CloseButton.MouseEnter:Connect(function()
    CloseButton.BackgroundColor3 = Color3.fromRGB(240, 90, 90)
end)

CloseButton.MouseLeave:Connect(function()
    CloseButton.BackgroundColor3 = Color3.fromRGB(220, 70, 70)
end)

MinimizeButton.MouseEnter:Connect(function()
    MinimizeButton.BackgroundColor3 = Color3.fromRGB(110, 110, 110)
end)

MinimizeButton.MouseLeave:Connect(function()
    MinimizeButton.BackgroundColor3 = Color3.fromRGB(90, 90, 90)
end)

ToggleButton.MouseEnter:Connect(function()
    if afkEnabled then
        ToggleButton.BackgroundColor3 = Color3.fromRGB(90, 240, 90)
    else
        ToggleButton.BackgroundColor3 = Color3.fromRGB(240, 90, 90)
    end
end)

ToggleButton.MouseLeave:Connect(function()
    if afkEnabled then
        ToggleButton.BackgroundColor3 = Color3.fromRGB(70, 220, 70)
    else
        ToggleButton.BackgroundColor3 = Color3.fromRGB(220, 70, 70)
    end
end)

task.wait(0.1)
if isMobile then
    MainFrame.Position = UDim2.new(0.5, -70, 0.5, -55)
end
